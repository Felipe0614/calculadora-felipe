<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora Felipe Investigación</title>
  <style>
    :root{
      --bg:#0f1115;
      --card:#1a1d23;
      --muted:#9ca3af;
      --accent:#f9fafb;
      --btn:#2a2e36;
      --btn-accent:#111827;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;}
    body{
      margin:0;
      display:grid;
      place-items:center;
      background:linear-gradient(180deg,var(--bg),#171a20);
      color:var(--accent);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    .card{
      width:340px;
      max-width:90vw;
      background:var(--card);
      border-radius:16px;
      box-shadow:0 6px 30px rgba(0,0,0,0.4);
      padding:20px;
    }
    .screen{
      height:64px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:flex-end;
      gap:6px;
      padding:12px 16px;
      border-radius:10px;
      background:#111317;
      margin-bottom:14px;
      word-break:break-all;
    }
    .history{font-size:13px;color:var(--muted);opacity:0.9;}
    .output{font-size:22px;font-weight:600;color:var(--accent);}
    .grid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:10px;
    }
    button{
      height:52px;
      border:0;
      border-radius:10px;
      background:var(--btn);
      font-size:18px;
      cursor:pointer;
      color:var(--accent);
      transition:background .2s, transform .1s;
    }
    button:hover{background:#353a44;}
    button:active{transform:translateY(1px);}
    .op{background:#252932;}
    .wide{grid-column:span 2;height:56px;border-radius:12px;}
    .equal{background:#3b82f6;color:white;font-weight:600;}
    .danger{background:#7f1d1d;color:#fca5a5;}
    .small{font-size:14px}
    @media (max-width:380px){
      .card{width:300px}
      .output{font-size:20px}
    }
  </style>
</head>
<body>
  <main class="card" role="application" aria-label="Calculadora minimalista">
    <div class="screen" aria-live="polite">
      <div id="history" class="history" aria-hidden="true"></div>
      <div id="display" class="output" role="textbox" aria-label="Pantalla de la calculadora">0</div>
    </div>

    <div class="grid" role="group" aria-label="Teclado de la calculadora">
      <button type="button" id="clear" class="danger small" aria-label="Limpiar">C</button>
      <button type="button" id="back" aria-label="Borrar">←</button>
      <button type="button" data-value="%" aria-label="Porcentaje">%</button>
      <button type="button" data-value="/" class="op" aria-label="Dividir">÷</button>

      <button type="button" data-value="7">7</button>
      <button type="button" data-value="8">8</button>
      <button type="button" data-value="9">9</button>
      <button type="button" data-value="*" class="op" aria-label="Multiplicar">×</button>

      <button type="button" data-value="4">4</button>
      <button type="button" data-value="5">5</button>
      <button type="button" data-value="6">6</button>
      <button type="button" data-value="-" class="op" aria-label="Restar">−</button>

      <button type="button" data-value="1">1</button>
      <button type="button" data-value="2">2</button>
      <button type="button" data-value="3">3</button>
      <button type="button" data-value="+" class="op" aria-label="Sumar">+</button>

      <button type="button" data-value="0" class="wide">0</button>
      <button type="button" data-value="." aria-label="Decimal">.</button>
      <button type="button" id="equals" class="equal" aria-label="Igual">=</button>
    </div>
  </main>

  <script>
    (function(){
      const displayEl = document.getElementById('display');
      const historyEl = document.getElementById('history');
      let expr = '';

      function update(){
        displayEl.textContent = expr === '' ? '0' : expr;
      }

      function pushValue(v){
        if(expr === '0' && /[0-9]/.test(v)) expr = v;
        else expr += v;
        update();
      }

      function clearAll(){ expr = ''; historyEl.textContent = ''; update(); }
      function back(){ expr = expr.slice(0,-1); update(); }

      function safeEval(s){
        if(!/^[0-9+\-*/().%\s]*$/.test(s)) throw new Error('Entrada inválida');
        s = s.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
        s = s.replace(/^[+\-*/]+/, '');
        const result = Function('return ('+s+')')();
        if(typeof result === 'number' && !Number.isFinite(result)) throw new Error('Resultado no finito');
        return result;
      }

      document.querySelectorAll('button[data-value]').forEach(btn=>{
        btn.addEventListener('click', ()=>{ pushValue(btn.dataset.value); });
      });

      document.getElementById('clear').addEventListener('click', clearAll);
      document.getElementById('back').addEventListener('click', ()=>{ back(); });
      document.getElementById('equals').addEventListener('click', ()=>{
        try{
          const res = safeEval(expr || '0');
          historyEl.textContent = expr + ' =';
          expr = String(res);
          update();
        }catch(e){
          displayEl.textContent = 'Error';
          setTimeout(()=>{ update(); },900);
        }
      });

      window.addEventListener('keydown', (ev)=>{
        if(ev.key === 'Enter' || ev.key === '='){ ev.preventDefault(); document.getElementById('equals').click(); return; }
        if(ev.key === 'Backspace'){ ev.preventDefault(); back(); return; }
        if(ev.key === 'Escape'){ ev.preventDefault(); clearAll(); return; }
        const allowed = '0123456789+-*/().%';
        if(allowed.includes(ev.key)){
          ev.preventDefault(); pushValue(ev.key);
        }
      });

      update();
    })();
  </script>
</body>
</html>
